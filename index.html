<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Viljas LÃ¤xa</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a84ff">
<style>
  :root{ --accent:#0a84ff; --ok:#2db55d; --err:#d32f2f; --muted:#666; }
  body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:20px;background:#fff;color:#111}
  h1{margin:0 0 6px;color:var(--accent);font-size:24px}
  .muted{color:var(--muted);font-size:13px}
  .bar{display:flex;gap:10px;align-items:center;margin-top:10px;flex-wrap:wrap}
  .chip{border:1px solid #e5e5ef;border-radius:999px;padding:6px 10px;font-size:12px;background:#fafafe}
  .btn{border:none;border-radius:10px;padding:12px 14px;font-weight:700;font-size:16px;cursor:pointer}
  .primary{background:var(--accent);color:#fff}
  .ghost{background:#eef4ff;color:#0a2a66}
  .danger{background:#ffe8e8;color:#7a1111}
  .card{border:1px solid #e6e6ef;border-radius:14px;padding:16px;margin-top:12px;box-shadow:0 1px 0 rgba(0,0,0,.02)}
  .def{font-size:18px;margin:6px 0 12px;min-height:48px}
  input[type=text]{width:100%;font-size:20px;padding:12px;border:1px solid #d9d9e3;border-radius:10px;outline:none}
  input[type=text]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(10,132,255,.15)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
  .feedback{min-height:22px;margin-top:8px;font-weight:700}
  .ok{color:var(--ok)} .err{color:var(--err)}
  .done{border:2px dashed #a7e5b7;background:#f2fff5;text-align:center;padding:16px;border-radius:14px}
  .small{font-size:12px}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:20px}
  .modal .panel{background:#fff;border-radius:14px;max-width:860px;width:100%;padding:16px;border:1px solid #e6e6ef}
  .list{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px;max-height:55vh;overflow:auto}
  .item{border:1px solid #eee;border-radius:10px;padding:10px}
  .item .w{font-weight:700}
  .item .d{color:#555;margin-top:4px}
  .item .actions{display:flex;gap:8px;margin-top:10px}
  .inputs{display:grid;grid-template-columns:1fr 2fr;gap:8px;margin-top:8px}
  .panel .row-top{display:flex;gap:8px;align-items:center;justify-content:space-between}
  @media(min-width:720px){ .list{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
<h1>Hej Vilja! ðŸŒŸ</h1>
<div class="muted">Dagens runda: klara alla ord minst en gÃ¥ng.</div>

<div class="bar">
  <div class="chip">Framsteg idag: <span id="progressText">0/0</span></div>
  <div class="chip">RÃ¤tt i rad: <span id="streakText">0</span></div>
  <button id="adminBtn" class="btn ghost">Pappa</button>
</div>

<div id="practiceCard" class="card">
  <div id="def" class="def">â€”</div>
  <input id="answer" type="text"
         autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" inputmode="latin"
         placeholder="Skriv ordet â€¦">
  <div class="row">
    <button id="check" class="btn primary">Kolla</button>
    <button id="skip" class="btn ghost">Hoppa Ã¶ver</button>
  </div>
  <div id="feedback" class="feedback"></div>
</div>

<div id="doneCard" class="done" style="display:none">
  <div style="font-size:20px;font-weight:800;margin-bottom:6px">Bra jobbat, Vilja! ðŸŽ‰</div>
  <div>Du har klarat alla ord i dagens runda.</div>
  <div class="row" style="justify-content:center;margin-top:12px">
    <button id="newRound" class="btn primary">KÃ¶r en runda till</button>
  </div>
  <div class="small muted" style="margin-top:6px">Tips: Om nÃ¥got ord kÃ¤ndes svÃ¥rt â€“ be Pappa att lÃ¤gga in fler exempel eller byta fÃ¶rklaring.</div>
</div>

<!-- Admin Modal -->
<div id="adminModal" class="modal" aria-hidden="true">
  <div class="panel">
    <div class="row-top">
      <div>
        <h2 style="margin:0">Pappa â€“ Redigera ord</h2>
        <div class="small muted">LÃ¤gg till, Ã¤ndra, ta bort. Ã„ndringar sparas fÃ¶rst nÃ¤r du trycker <strong>Spara</strong>.</div>
      </div>
      <div>
        <button id="closeAdmin" class="btn ghost" style="min-width:auto">StÃ¤ng</button>
      </div>
    </div>

    <div class="inputs">
      <input id="wInput" type="text" placeholder="Ord (t.ex. 'budget')">
      <input id="dInput" type="text" placeholder="Definition (fÃ¶rklaring)">
    </div>
    <div class="row">
      <button id="addWord" class="btn primary">Spara</button>
      <button id="clearInputs" class="btn ghost">Avbryt</button>
    </div>

    <div class="list" id="wordList"></div>

    <div class="row" style="margin-top:12px;justify-content:space-between">
      <button id="resetToday" class="btn ghost">BÃ¶rja om dagens runda</button>
      <button id="resetAll" class="btn danger">Rensa allt (ord & framsteg)</button>
    </div>
  </div>
</div>

<script>
// --- Helpers to force-disable iOS autocorrect in PWA ---
(function(){
  const a = document.getElementById("answer");
  ["autocorrect","autocomplete","autocapitalize","spellcheck"].forEach((attr,i)=>{
    if(attr==="spellcheck"){ a.setAttribute(attr,"false"); } else { a.setAttribute(attr,"off"); }
  });
  a.setAttribute("inputmode","latin");
})();

const DEFAULT_WORDS = [
  { w:"pengar", d:"AllmÃ¤nna medel vi betalar med, bÃ¥de sedlar och digitalt." },
  { w:"kontanter", d:"Fysiska pengar: sedlar och mynt." },
  { w:"inkomst", d:"Pengar som kommer in, t.ex. lÃ¶n eller ersÃ¤ttning." },
  { w:"skatt", d:"Pengar man betalar till staten/kommunen fÃ¶r gemensam nytta." },
  { w:"budget", d:"Plan fÃ¶r inkomster och utgifter sÃ¥ pengarna rÃ¤cker." },
  { w:"lungor", d:"Organen vi andas med, tar upp syre till blodet." },
  { w:"luftrÃ¶r", d:"RÃ¶r som leder luft till och frÃ¥n lungorna." },
  { w:"koldioxid", d:"Gas (COâ‚‚) vi andas ut; bildas nÃ¤r kroppen anvÃ¤nder energi." },
  { w:"svalg", d:"Delen lÃ¤ngst bak i mun och hals dÃ¤r luft och mat passerar." }
];

const KEY_WORDS = "vilja_words_v3";
const KEY_DAY   = "vilja_day_state_v4";

function todayStr(){ return new Date().toISOString().slice(0,10); }
function loadWords(){
  try{ const raw = localStorage.getItem(KEY_WORDS); if(raw){ const arr = JSON.parse(raw); if(Array.isArray(arr)){ return arr; } } }catch(e){}
  return DEFAULT_WORDS.slice();
}
function saveWords(arr){ localStorage.setItem(KEY_WORDS, JSON.stringify(arr)); }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]]; } return a; }

let WORDS = loadWords();
let day = JSON.parse(localStorage.getItem(KEY_DAY) || "{}");
function resetDay(){
  day = { date: todayStr(), remaining: shuffle(WORDS.map(o=>o.w)), done: [], streak:0 };
  localStorage.setItem(KEY_DAY, JSON.stringify(day));
}
if(day.date !== todayStr() || !Array.isArray(day.remaining) || !Array.isArray(day.done)){ resetDay(); }

const defEl = document.getElementById("def");
const answerEl = document.getElementById("answer");
const feedbackEl = document.getElementById("feedback");
const progressText = document.getElementById("progressText");
const streakText = document.getElementById("streakText");
const practiceCard = document.getElementById("practiceCard");
const doneCard = document.getElementById("doneCard");
const checkBtn = document.getElementById("check");
const skipBtn = document.getElementById("skip");

const adminBtn = document.getElementById("adminBtn");
const adminModal = document.getElementById("adminModal");
const closeAdmin = document.getElementById("closeAdmin");
const wordList = document.getElementById("wordList");
const wInput = document.getElementById("wInput");
const dInput = document.getElementById("dInput");
const addWordBtn = document.getElementById("addWord");
const clearInputsBtn = document.getElementById("clearInputs");
const resetTodayBtn = document.getElementById("resetToday");
const resetAllBtn = document.getElementById("resetAll");
const newRoundBtn = document.getElementById("newRound");

let current = null;
let editIndex = null;

function updateProgress(){ progressText.textContent = `${day.done.length}/${WORDS.length}`; streakText.textContent = day.streak || 0; }
function pickNext(){
  if(day.remaining.length === 0){ practiceCard.style.display = "none"; doneCard.style.display = "block"; return; }
  const w = day.remaining[day.remaining.length - 1];
  current = WORDS.find(o => o.w === w);
  defEl.textContent = current ? current.d : "â€”";
  answerEl.value = ""; feedbackEl.textContent = ""; feedbackEl.className = "feedback";
  requestAnimationFrame(()=>answerEl.focus());
  updateProgress();
}
function correct(){
  feedbackEl.textContent = "RÃ¤tt! ðŸŽ‰"; feedbackEl.className = "feedback ok";
  day.streak = (day.streak||0) + 1;
  day.done.push(current.w); day.remaining.pop();
  localStorage.setItem(KEY_DAY, JSON.stringify(day));
  updateProgress();
  setTimeout(pickNext, 1500);
}
function wrong(){
  feedbackEl.innerHTML = `NÃ¤stan! RÃ¤tt svar Ã¤r <strong>"${current.w}"</strong>`; feedbackEl.className = "feedback err";
  day.streak = 0;
  const idx = day.remaining.indexOf(current.w);
  if(idx !== -1){ day.remaining.splice(idx,1); day.remaining.splice(0,0,current.w); }
  localStorage.setItem(KEY_DAY, JSON.stringify(day)); updateProgress();
}
function check(){
  const val = (answerEl.value||"").trim().toLowerCase(); if(!current || !val) return;
  if(val === current.w.toLowerCase()) correct(); else wrong();
}

// Admin
function renderAdminList(){
  wordList.innerHTML = "";
  WORDS.forEach((o, i) => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `<div class="w">${o.w}</div>
      <div class="d">${o.d}</div>
      <div class="actions">
        <button class="btn ghost" data-edit="${i}">Ã„ndra</button>
        <button class="btn danger" data-del="${i}">Ta bort</button>
      </div>`;
    wordList.appendChild(div);
  });
  wordList.querySelectorAll("[data-edit]").forEach(b => b.onclick = (e)=>{
    editIndex = parseInt(e.currentTarget.getAttribute("data-edit"));
    wInput.value = WORDS[editIndex].w; dInput.value = WORDS[editIndex].d;
    addWordBtn.textContent = "Spara Ã¤ndring"; clearInputsBtn.textContent = "Avbryt"; wInput.focus();
  });
  wordList.querySelectorAll("[data-del]").forEach(b => b.onclick = (e)=>{
    const idx = parseInt(e.currentTarget.getAttribute("data-del"));
    if(confirm(`Ta bort ordet "${WORDS[idx].w}"?`)){
      WORDS.splice(idx,1); saveWords(WORDS); resetDay();
      renderAdminList(); updateProgress(); pickNext();
    }
  });
}
function clearInputs(){ editIndex = null; wInput.value = ""; dInput.value = ""; addWordBtn.textContent = "Spara"; clearInputsBtn.textContent = "Avbryt"; }
addWordBtn.onclick = ()=>{
  const w = (wInput.value||"").trim(); const d = (dInput.value||"").trim();
  if(!w || !d){ alert("Fyll i bÃ¥de ord och definition."); return; }
  if(editIndex === null){ WORDS.push({ w, d }); } else { WORDS[editIndex] = { w, d }; }
  saveWords(WORDS); resetDay(); clearInputs(); renderAdminList(); updateProgress(); pickNext();
};
clearInputsBtn.onclick = clearInputs;
adminBtn.onclick = ()=>{ adminModal.style.display="flex"; renderAdminList(); };
closeAdmin.onclick = ()=>{ adminModal.style.display="none"; };
adminModal.addEventListener("click", (e)=>{ if(e.target === adminModal){ adminModal.style.display="none"; } });

resetTodayBtn.onclick = ()=>{ if(confirm("BÃ¶rja om dagens runda?")){ resetDay(); practiceCard.style.display="block"; doneCard.style.display="none"; pickNext(); } };
resetAllBtn.onclick = ()=>{
  if(confirm("Rensa ALLT (ordlista & framsteg)?")){
    localStorage.removeItem(KEY_WORDS); localStorage.removeItem(KEY_DAY);
    WORDS = loadWords(); resetDay(); practiceCard.style.display="block"; doneCard.style.display="none";
    renderAdminList(); updateProgress(); pickNext();
  }
};
newRoundBtn.onclick = ()=>{ resetDay(); practiceCard.style.display="block"; doneCard.style.display="none"; pickNext(); };

// Start
updateProgress(); pickNext();

// Service worker update hint
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js").then(reg => {
    reg.onupdatefound = () => {
      const newSW = reg.installing;
      newSW.onstatechange = () => {
        if (newSW.state === "installed" && navigator.serviceWorker.controller) {
          skipBtn.textContent = "Hoppa Ã¶ver (uppdaterar)";
          skipBtn.onclick = () => { location.reload(); };
        }
      };
    };
  });
}
</script>
</body>
</html>
